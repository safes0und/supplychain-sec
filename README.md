# SupplyChain-Sec

Проект посвящён демонстрации современных практик и инструментов для построения безопасной цепочки поставок (Secure Supply Chain) — от сканирования кода до подписей артефактов и проверки целостности всего пайплайна CI/CD:

- **SAST** (Static Application Security Testing)
- **SBOM** (Software Bill of Materials) генерация и аттестация
- **Подписи образов** через Cosign (keyless OIDC)
- **SLSA Provenance** для отслеживания происхождения артефакта
- **in-toto** для верификации целостности цепочки поставок
- **Сканирование уязвимостей репозитория и зависимостей** 

## Технологии и использованные инструменты

- **Python 3.12** - язык программирования
- **Flask** - веб-фреймворк
- **Gunicorn** - WSGI HTTP сервер
- **Docker** - контейнеризация
- **GitHub Actions** - CI/CD pipeline
- **Semgrep** — статический анализ исходного кода и репозитория на наличие потенциальных уязвимостей (SAST).
- **Trivy** — сканирование зависимостей Python, конфигураций Docker и собранных образов на наличие уязвимостей.
- **Cosign** — подпись Docker-образов (attestation и keyless OIDC signing) для контроля подлинности и защищённости артефактов.
- **in-toto** — создание layout и продвинутая криптографическая верификация целостности всех этапов пайплайна на основании подписей и результатов.
- **requirements.txt с хешами** — строгая фиксация и верификация зависимостей с помощью хеш-сумм для защиты от подмены пакетов.
- **Автоматизация проверки целостности перед деплоем** — артефакт развертывается только после прохождения всех проверок и верификации подписей.


## Структура проекта

```
SupplyChain-Sec/
├── app.py                   # Основное Flask приложение
├── Dockerfile 
├── functionary-key.pub      # публичный ключ для in-toto
├── supplychain.layout       # layout файл для in-toto
├── requirements.txt         # Зависимости Python (с хешами)
└── .github/
    └── workflows/
        └── secure-supplychain.yml  # CI/CD pipeline
```

## CI/CD Pipeline

Workflow запускается только в ручном режиме:

### 1. Build & Attest
- Сканирование кода (Semgrep SAST)
- Сканирование зависимостей и конфигураций (Trivy)
- Генерация SBOM для зависимостей и образа
- Сборка Docker образа
- Запись метаданных in-toto для каждого этапа

### 2. Generate SLSA Provenance
- Генерация SLSA L3 provenance для собранного образа

### 3. Collect SLSA Provenance
- Скачивание и сохранение SLSA метаданных

### 4. Sign & Attest
- Подпись образа через Cosign (keyless OIDC)
- Аттестация SBOM, результатов сканирований
- Верификация всех этапов цепочки поставок

### 5. Deploy to Self-Hosted
- Деплой образа на self-hosted runner с Linux
- Автоматический перезапуск контейнера

## Безопасность

Проект демонстрирует следующие практики безопасности:

- ✅ **SAST сканирование** - автоматическое обнаружение уязвимостей
- ✅ **SBOM генерация** - полный список зависимостей и их версий
- ✅ **Подписи образов** - криптографическая подпись Docker образов
- ✅ **SLSA Provenance** - отслеживание происхождения артефактов
- ✅ **in-toto верификация** - проверка целостности цепочки поставок
- ✅ **Зависимости с хешами** - защита от подмены пакетов

## Артефакты

Pipeline генерирует следующие артефакты:

- `security-artifacts` - результаты сканирований и SBOM
- `slsa-provenance` - SLSA метаданные
- `in-toto-metadata` - layout, link файлы и публичные ключи
